<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>临床试验样本量计算器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom slider styling */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            background: transparent;
            cursor: pointer;
        }
        input[type="range"]::-webkit-slider-track {
            background-color: #e2e8f0;
            height: 0.5rem;
            border-radius: 0.5rem;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            margin-top: -4px;
            background-color: #3b82f6;
            height: 1rem;
            width: 1rem;
            border-radius: 50%;
        }
        input[type="range"]::-moz-range-track {
            background-color: #e2e8f0;
            height: 0.5rem;
            border-radius: 0.5rem;
        }
        input[type="range"]::-moz-range-thumb {
            background-color: #3b82f6;
            height: 1rem;
            width: 1rem;
            border-radius: 50%;
            border: none;
        }
        .accent-emerald-500::-webkit-slider-thumb {
            background-color: #10b981;
        }
        .accent-purple-600::-webkit-slider-thumb {
            background-color: #9333ea;
        }
        .accent-orange-500::-webkit-slider-thumb {
            background-color: #f97316;
        }
    </style>
</head>
<body class="min-h-screen bg-slate-50 p-4 md:p-8 font-sans text-slate-800">
    <div class="max-w-6xl mx-auto space-y-6" id="app"></div>

    <script>
        // State variables
        let state = {
            p1: 25,
            p2: 65,
            alpha: 0.05,
            power: 90,
            dropout: 20,
            method: 'continuity',
            copied: false
        };

        // Helper: Inverse Normal Distribution
        function getNormInv(p) {
            if (p < 0 || p > 1) return 0;
            if (p < 0.5) return -getNormInv(1 - p);
            
            const t = Math.sqrt(-2 * Math.log(1 - p));
            const c0 = 2.515517, c1 = 0.802853, c2 = 0.010328;
            const d1 = 1.432788, d2 = 0.189269, d3 = 0.001308;
            return t - ((c2 * t + c1) * t + c0) / (((d3 * t + d2) * t + d1) * t + 1);
        }

        const zScoreAlphaMap = {
            "0.01": 2.576,
            "0.025": 2.241, 
            "0.05": 1.960, 
            "0.10": 1.645
        };

        // Core calculation
        function calculateSingleScenario(p1Val, p2Val, alphaVal, powerValPercent, dropoutVal, methodVal) {
            const rate1 = p1Val / 100;
            const rate2 = p2Val / 100;
            const diff = Math.abs(rate1 - rate2);

            if (diff === 0) return { nPerGroup: 0, nPerGroupAdjusted: 0, totalAdjusted: 0 };

            const zAlpha = zScoreAlphaMap[alphaVal.toString()] || 1.96;
            const zBeta = getNormInv(powerValPercent / 100);

            const pooledVariance = (rate1 * (1 - rate1)) + (rate2 * (1 - rate2));
            const numerator = Math.pow(zAlpha + zBeta, 2) * pooledVariance;
            const denominator = Math.pow(diff, 2);
            let nUncorrected = numerator / denominator;
            let finalN = nUncorrected;

            if (methodVal === 'continuity') {
                const term = 2 / (nUncorrected * diff);
                const correctionFactor = Math.pow(1 + Math.sqrt(1 + term), 2);
                finalN = (nUncorrected / 4) * correctionFactor;
            }

            const nPerGroup = Math.ceil(finalN);
            const nPerGroupAdjusted = Math.ceil(nPerGroup / (1 - (dropoutVal / 100)));

            return {
                nPerGroup,
                nPerGroupAdjusted,
                totalAdjusted: nPerGroupAdjusted * 2
            };
        }

        // Generate calculation data
        function getCalculationData() {
            const mainResult = calculateSingleScenario(state.p1, state.p2, state.alpha, state.power, state.dropout, state.method);

            const scenarios = [
                { label: "保守估计 (Conservative)", p2Mod: -10 },
                { label: "微调 (Moderate)", p2Mod: -5 },
                { label: "当前假设 (Base Case)", p2Mod: 0 },
                { label: "乐观估计 (Optimistic)", p2Mod: 5 },
            ];

            const sensitivityTable = scenarios.map(sc => {
                let simP2 = state.p2 + sc.p2Mod;
                if (simP2 < 1) simP2 = 1;
                if (simP2 > 99) simP2 = 99;
                if (simP2 === state.p1) return null;

                const resPower80 = calculateSingleScenario(state.p1, simP2, state.alpha, 80, state.dropout, state.method);
                const resCurrentPower = calculateSingleScenario(state.p1, simP2, state.alpha, state.power, state.dropout, state.method);

                return {
                    ...sc,
                    simP2,
                    nPower80: resPower80.nPerGroupAdjusted,
                    nCurrentPower: resCurrentPower.nPerGroupAdjusted
                };
            }).filter(Boolean);

            return { mainResult, sensitivityTable };
        }

        // Generate text for protocol
        function generateText() {
            const { mainResult } = getCalculationData();
            const methodText = state.method === 'continuity' 
                ? "Casagrande-Pike-Smith 校正公式 (Casagrande et al., 1978)" 
                : "两独立样本率的正态近似公式 (Normal Approximation)";

            return `6.1 样本量计算依据 (Sample Size Determination)

本研究样本量计算采用 PASS 软件逻辑,基于两独立样本率的优效性检验(Tests for Two Proportions)。计算公式采用适用于小样本设计的 ${methodText},以确保统计效能。

参数假设如下:
1. 对照组(Control Group):假设事件发生率为 ${state.p1}%。
2. 试验组(Experimental Group):假设事件发生率为 ${state.p2}%。
3. 效应差异(Effect Size):预期组间差异为 ${Math.abs(state.p1 - state.p2).toFixed(1)}%。

统计学参数设定为:
- I 类错误率(双侧 α):${state.alpha}
- 把握度(Power, 1-β):${state.power}%

计算结果:
在上述假设下,理论每组需 ${mainResult.nPerGroup} 例受试者即可达到预设的统计学效能。

样本量修正:
考虑到临床试验中约 ${state.dropout}% 的失访或脱落率(Dropout Rate),我们将样本量调整为每组 ${mainResult.nPerGroupAdjusted} 例。
最终总样本量为 N = ${mainResult.totalAdjusted} 例。

参考文献:
1. Casagrande, J. T., Pike, M. C., & Smith, P. G. (1978). An improved approximate formula for calculating sample sizes for comparing two binomial distributions. Biometrics, 34, 483-486.`;
        }

        // Event handlers
        function handleP1Change(val) {
            state.p1 = Math.min(99, Math.max(0, parseInt(val) || 0));
            render();
        }

        function handleP2Change(val) {
            state.p2 = Math.min(99, Math.max(0, parseInt(val) || 0));
            render();
        }

        function handlePowerChange(val) {
            state.power = Math.min(99, Math.max(50, parseInt(val) || 80));
            render();
        }

        function handleDropoutChange(val) {
            state.dropout = Math.min(99, Math.max(0, parseInt(val) || 0));
            render();
        }

        function handleAlphaChange(val) {
            state.alpha = parseFloat(val);
            render();
        }

        function handleMethodChange(checked) {
            state.method = checked ? 'continuity' : 'uncorrected';
            render();
        }

        function handleReset() {
            state = {
                p1: 25,
                p2: 65,
                alpha: 0.05,
                power: 90,
                dropout: 20,
                method: 'continuity',
                copied: false
            };
            render();
        }

        function handleCopy() {
            navigator.clipboard.writeText(generateText());
            state.copied = true;
            render();
            setTimeout(() => {
                state.copied = false;
                render();
            }, 2000);
        }

        // Render function
        function render() {
            const data = getCalculationData();
            const app = document.getElementById('app');
            
            app.innerHTML = `
                <!-- Header -->
                <header class="flex flex-col md:flex-row md:items-center justify-between pb-6 border-b border-slate-200 gap-4">
                    <div class="flex items-center space-x-3">
                        <div class="bg-blue-600 p-3 rounded-xl shadow-lg shadow-blue-200">
                            <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                            </svg>
                        </div>
                        <div>
                            <h1 class="text-2xl font-bold text-slate-900">临床试验样本量计算器</h1>
                            <p class="text-slate-500 text-sm">两独立样本率比较 (Two Independent Proportions)</p>
                        </div>
                    </div>
                    <button onclick="handleReset()" class="flex items-center justify-center px-4 py-2 text-sm font-medium text-slate-600 bg-white border border-slate-200 rounded-lg hover:bg-slate-50 hover:text-blue-600 transition-colors shadow-sm">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                        </svg>
                        重置默认值
                    </button>
                </header>

                <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                    <!-- Left Column: Inputs -->
                    <div class="lg:col-span-5 space-y-6">
                        <div class="bg-white rounded-2xl p-6 shadow-sm border border-slate-200">
                            <h2 class="text-lg font-semibold flex items-center mb-6">
                                <svg class="w-5 h-5 mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                                </svg>
                                参数设定 (Parameters)
                            </h2>

                            <!-- P1 Input -->
                            <div class="space-y-8">
                                <div class="relative">
                                    <div class="flex justify-between items-center mb-2">
                                        <label class="text-sm font-medium text-slate-700">对照组发生率 (P1)</label>
                                        <div class="flex items-center">
                                            <input type="number" value="${state.p1}" onchange="handleP1Change(this.value)" class="w-16 p-1 text-center font-bold text-blue-600 bg-blue-50 border border-blue-100 rounded focus:ring-2 focus:ring-blue-500 outline-none">
                                            <span class="ml-1 text-sm text-blue-600 font-bold">%</span>
                                        </div>
                                    </div>
                                    <div class="h-1.5 w-full bg-slate-100 rounded-full mb-3 overflow-hidden">
                                        <div class="h-full bg-blue-500 transition-all duration-300" style="width: ${state.p1}%"></div>
                                    </div>
                                    <input type="range" min="1" max="99" step="1" value="${state.p1}" oninput="handleP1Change(this.value)" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-blue-600 block">
                                    <p class="text-xs text-slate-400 mt-1">例如:安慰剂组 (25%)</p>
                                </div>

                                <!-- P2 Input -->
                                <div class="relative">
                                    <div class="flex justify-between items-center mb-2">
                                        <label class="text-sm font-medium text-slate-700">试验组发生率 (P2)</label>
                                        <div class="flex items-center">
                                            <input type="number" value="${state.p2}" onchange="handleP2Change(this.value)" class="w-16 p-1 text-center font-bold text-emerald-600 bg-emerald-50 border border-emerald-100 rounded focus:ring-2 focus:ring-emerald-500 outline-none">
                                            <span class="ml-1 text-sm text-emerald-600 font-bold">%</span>
                                        </div>
                                    </div>
                                    <div class="h-1.5 w-full bg-slate-100 rounded-full mb-3 overflow-hidden">
                                        <div class="h-full bg-emerald-500 transition-all duration-300" style="width: ${state.p2}%"></div>
                                    </div>
                                    <input type="range" min="1" max="99" step="1" value="${state.p2}" oninput="handleP2Change(this.value)" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-emerald-500 block">
                                    <p class="text-xs text-slate-400 mt-1">例如:玛仕度肽组 (65%)</p>
                                </div>
                            </div>

                            <div class="h-px bg-slate-100 my-6"></div>

                            <!-- Statistical Parameters -->
                            <div class="space-y-6">
                                <!-- Power -->
                                <div>
                                    <div class="flex justify-between items-center mb-2">
                                        <label class="text-sm font-medium text-slate-700">把握度 (Power)</label>
                                        <div class="flex items-center">
                                            <input type="number" value="${state.power}" onchange="handlePowerChange(this.value)" class="w-14 p-1 text-center font-bold text-purple-600 bg-purple-50 border border-purple-100 rounded focus:ring-2 focus:ring-purple-500 outline-none text-sm">
                                            <span class="ml-1 text-sm text-purple-600 font-bold">%</span>
                                        </div>
                                    </div>
                                    <input type="range" min="50" max="99" step="1" value="${state.power}" oninput="handlePowerChange(this.value)" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-purple-600 block">
                                    <div class="flex justify-between text-xs text-slate-400 mt-1">
                                        <span>80% (标准)</span>
                                        <span>90% (推荐)</span>
                                        <span>99% (极高)</span>
                                    </div>
                                </div>

                                <!-- Alpha -->
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-1">I 类错误 (Alpha)</label>
                                    <select value="${state.alpha}" onchange="handleAlphaChange(this.value)" class="w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none cursor-pointer">
                                        <option value="0.01">0.01 (99% Confidence)</option>
                                        <option value="0.05" selected>0.05 (95% Confidence) - 标准</option>
                                        <option value="0.10">0.10 (90% Confidence)</option>
                                    </select>
                                </div>

                                <!-- Dropout -->
                                <div>
                                    <div class="flex justify-between items-center mb-1">
                                        <label class="block text-sm font-medium text-slate-700">脱落率 (Dropout Rate)</label>
                                        <div class="flex items-center">
                                            <input type="number" value="${state.dropout}" onchange="handleDropoutChange(this.value)" class="w-14 p-0.5 text-center font-bold text-orange-600 bg-orange-50 border border-orange-100 rounded focus:ring-2 focus:ring-orange-500 outline-none text-sm">
                                            <span class="ml-1 text-sm text-orange-600">%</span>
                                        </div>
                                    </div>
                                    <input type="range" min="0" max="40" step="1" value="${state.dropout}" oninput="handleDropoutChange(this.value)" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-orange-500 block">
                                </div>
                            </div>

                            <!-- Continuity Correction -->
                            <div class="mt-6 p-4 bg-slate-50 rounded-lg border border-slate-100 hover:bg-slate-100 transition-colors">
                                <label class="flex items-start space-x-3 cursor-pointer">
                                    <div class="flex items-center h-5">
                                        <input type="checkbox" ${state.method === 'continuity' ? 'checked' : ''} onchange="handleMethodChange(this.checked)" class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                                    </div>
                                    <div class="ml-2 text-sm">
                                        <span class="font-medium text-slate-800">使用连续性校正 (推荐)</span>
                                        <p class="text-slate-500 text-xs mt-1">Casagrande-Pike-Smith 方法。适用于小样本或需要 Fisher 精确检验的情况,结果更保守严谨。</p>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column -->
                    <div class="lg:col-span-7 space-y-6">
                        <!-- Results Cards -->
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 flex flex-col justify-between relative overflow-hidden">
                                <div class="absolute top-0 right-0 p-4 opacity-10">
                                    <svg class="w-24 h-24 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path>
                                    </svg>
                                </div>
                                <div>
                                    <p class="text-sm text-slate-500 font-medium uppercase tracking-wider">理论样本量 (每组)</p>
                                    <div class="mt-2 flex items-baseline">
                                        <span class="text-4xl font-extrabold text-slate-800">${data.mainResult.nPerGroup}</span>
                                        <span class="ml-2 text-sm text-slate-500">例</span>
                                    </div>
                                </div>
                                <div class="mt-4 pt-4 border-t border-slate-100">
                                    <p class="text-xs text-slate-400">Total N = ${data.mainResult.nPerGroup * 2} (无脱落)</p>
                                </div>
                            </div>

                            <div class="bg-gradient-to-br from-blue-600 to-blue-700 p-6 rounded-2xl shadow-lg shadow-blue-200 text-white flex flex-col justify-between relative overflow-hidden">
                                <div class="absolute top-0 right-0 p-4 opacity-20">
                                    <svg class="w-24 h-24 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                    </svg>
                                </div>
                                <div>
                                    <p class="text-sm text-blue-100 font-medium uppercase tracking-wider flex items-center">
                                        推荐样本量 (每组)
                                        <svg class="w-4 h-4 ml-1 opacity-70" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                    </p>
                                    <div class="mt-2 flex items-baseline">
                                        <span class="text-5xl font-extrabold">${data.mainResult.nPerGroupAdjusted}</span>
                                        <span class="ml-2 text-lg text-blue-100 opacity-80">例 / 组</span>
                                    </div>
                                </div>
                                <div class="mt-4 pt-4 border-t border-blue-500/50">
                                    <div class="flex justify-between items-end">
                                        <div>
                                            <p class="text-xs text-blue-200 uppercase tracking-wide">总样本量 (Total N)</p>
                                            <p class="text-xl font-bold">${data.mainResult.totalAdjusted}</p>
                                        </div>
                                        <div class="text-right">
                                            <span class="text-xs bg-blue-800/50 px-2 py-1 rounded text-blue-100">含 ${state.dropout}% 脱落率</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        ${data.mainResult.nPerGroupAdjusted < 30 ? `
                        <div class="flex items-start p-4 bg-amber-50 border border-amber-200 rounded-xl text-amber-800 text-sm">
                            <svg class="w-5 h-5 mr-2 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <p><strong>注意:</strong> 计算出的样本量较小(&lt;30例/组)。虽然统计学上可行,但可能无法充分评估安全性(Safety)。建议将样本量圆整至 30-50 例以满足法规对安全性暴露的基本要求。</p>
                        </div>
                        ` : ''}

                        <!-- Sensitivity Table -->
                        <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                            <div class="p-4 bg-slate-50 border-b border-slate-100 flex items-center">
                                <svg class="w-4 h-4 mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                </svg>
                                <h3 class="font-semibold text-slate-800 text-sm">敏感性分析:不同疗效与把握度 (Sensitivity Analysis)</h3>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm text-left">
                                    <thead class="bg-slate-50/50 text-slate-500 font-medium border-b border-slate-100">
                                        <tr>
                                            <th class="px-4 py-3">场景假设 (Scenario)</th>
                                            <th class="px-4 py-3">试验组 P2</th>
                                            <th class="px-4 py-3 text-slate-400">Power 80% (N/组)</th>
                                            <th class="px-4 py-3 bg-purple-50/50 text-purple-700">Power ${state.power}% (N/组)</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-slate-50">
                                        ${data.sensitivityTable.map(row => `
                                            <tr class="hover:bg-slate-50 transition-colors ${row.p2Mod === 0 ? 'bg-purple-50/30 font-medium' : ''}">
                                                <td class="px-4 py-3 text-slate-700">
                                                    ${row.label}
                                                    ${row.p2Mod === 0 ? '<span class="ml-2 text-xs bg-purple-100 text-purple-700 px-1.5 py-0.5 rounded-full">当前</span>' : ''}
                                                </td>
                                                <td class="px-4 py-3 text-emerald-600 font-medium">${row.simP2}%</td>
                                                <td class="px-4 py-3 text-slate-400">${row.nPower80}</td>
                                                <td class="px-4 py-3 text-purple-700 bg-purple-50/30 font-bold">${row.nCurrentPower}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                            <div class="p-3 bg-slate-50/50 border-t border-slate-100 text-xs text-slate-400">
                                * 表中 N 值为包含 ${state.dropout}% 脱落率后的每组样本量推荐值。
                            </div>
                        </div>

                        <!-- Protocol Writer -->
                        <div class="bg-white rounded-2xl shadow-sm border border-slate-200 flex flex-col h-[300px]">
                            <div class="p-4 border-b border-slate-100 flex justify-between items-center bg-slate-50/50 rounded-t-2xl">
                                <h3 class="font-semibold text-slate-800 flex items-center">
                                    <svg class="w-4 h-4 mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                    </svg>
                                    方案撰写助手 (Protocol Writer)
                                </h3>
                                <button onclick="handleCopy()" class="flex items-center px-3 py-1.5 rounded-lg text-sm transition-all duration-200 ${state.copied ? 'bg-green-100 text-green-700' : 'bg-white border border-slate-200 hover:bg-slate-50 text-slate-600'}">
                                    ${state.copied ? 
                                        '<svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg> 已复制' : 
                                        '<svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg> 复制文本'
                                    }
                                </button>
                            </div>
                            <div class="flex-1 p-4 overflow-y-auto bg-slate-50/30">
                                <textarea readonly class="w-full h-full bg-transparent resize-none outline-none text-sm text-slate-700 font-mono leading-relaxed focus:bg-white transition-colors p-2 rounded">${generateText()}</textarea>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Initialize
        render();
    </script>
</body>
</html>
